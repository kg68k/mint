		[ v2.25 -> v3.xx 移行マニュアル ]


　このファイルでは、mint version 2.25 から mint version 3.xx に移行する
ために最低限必要な、定義ファイルの変更作業を解説しています。version 3.xx
において追加・拡張された機能に関しては v3_extend.man を参照して下さい。

　なお、定義ファイルを変更しなくてもある程度は動きますが、% 系変数の削除
は必須です。&menu は書き方によっては動かなくなるのでチェックが必要です。
&～-eject は &eject に一本化されたので変更が必要です。


・% 系変数の削除

　% や %e など、% から始まる変数は全て削除されました。これらは $ から始
まる変数に置き換える必要があります。基本的に以下のように置き換えれば動作
します。

	%	->	$F
	%e	->	$F:e
	%+	->	〃
	%.	->	$F:r
	%p	->	$C
	%o	->	$O
	%p/%	->	$P
	%d	->	$C:d
	%c	->	$O:d
	%k	->	$<
	%*	->	$M
	%#	->	$B
	%v	->	$LOOK_FILE_NAME
	% %z	->	$MINTARC

　なお、$ 系変数にはマーク時の自動繰り返し機能はないので、従来

	foo %

として自動ループを行っていたものは、

	&foreach ( $MARK ) { foo $_ }

のように変更して下さい。

　詳細は v2.25 のマニュアルを参照して下さい。


・削除されたシステム変数

　以下のシステム変数が削除されていますが、存在しない変数を設定しても無視
されるので、特に定義ファイルを修正する必要はありません。

%cfex
	　実行ファイルの検索は完全に OS に委ねるようにしたので削除されま
	した。最初にカレントディレクトリを見るかどうかは OS の仕様により
	ます。

%gmd3
	　削除されました。確か他の操作との関係だったと思いますが、今の状
	態の方が簡潔になっていると思います(何がどう変わったのかよく覚え
	てません…)。

%grmd
	　グラフィックは常に初期化しないようになった為、削除されました。

%lnd7
	　アーカイブ属性のないファイルを実行可能と見なす理由・利点がない
	ため削除されました。

%mutg
	　&data-title の表示行は常にコンソールの一番上の行になった為、削
	除されました。

%path
	　既に意味がなくなっていたので削除されました。

%sepa
	　%winf に統合されました。以下のように書き換えて下さい。
		%winf 0 & %sepa 1	→	%winf 0
		%winf 0 & %sepa 0	→	%winf 4

%titl
	　タイトル画像は起動中に表示されるようになったため、表示秒数の指
	定は無意味となり、削除されました。ただ、速い機種では表示が短すぎ
	るので、将来復活するかも知れません(>A_EXEC で表示して &wait で待
	機すればいいのかも)。


・削除された内部命令

　以下の内部命令は削除されましたので、使わないようにして下さい。

&cache-information
&interrupt-window-print
	　使う必要の無い筈の命令です。キャッシュや割り込みの状態が正しく
	更新されなければ、それはバグですので、報告して下さい。

&fd-eject
&mo-eject
&scsi-eject
	　IOCS レベルでメディアの排出を行うと、OS のバッファ管理と矛盾が
	生じるので、OS レベルでメディアの排出を行う &eject 命令に変更さ
	れました。それぞれ

		&eject fd<n>	(<n> = 0～)
		&eject mo<n>
		&eject mo<n>、cd<n>、hd<n> など

	に書き換えて下さい。<n> は、&fd-eject の場合は数字をそのまま移せ
	ばだいたい同じになります。&mo-eject は &eject mo0 としておけばた
	いていの場合は期待通りに動作します。この数値は元の指定とは違う方
	式になっていますが、説明が長くなるので省略します。mintfunc.man
	を見て各自で試してみて下さい。

	　&eject 命令は d: 形式のドライブ名による指定も受け付けるので、
	普段ドライブ構成が変動しない人はドライブ名に書き換えると楽だと思
	います。

&mint-title
	　タイトル画像を内蔵しなくなったのと、&title-load で読み込んだフ
	ァイルを内部バッファに保存しなくなっため、削除されました。

&push-text
	　特殊かつ危険な動作をしていましたが、意味がないので削除されまし
	た。この命令がなければ実現出来ない機能があった場合は報告してもら
	えれば対応します。

&sailor-mars = &rei@hino
	　歴史的価値のある非常に興味深い命令でしたが、サポート担当者の趣
	味により &one-ring に変更されました。

&set-16colors-brightness-to-half
&set-16colors-brightness-to-max = &max16
&set-64kcolors-brightness-to-half
&set-64kcolors-brightness-to-max = &max6
	　特に色数別の命令を用意する必要がなかったので削除されました。
	&half と &max に書き換えて下さい。

&set-current-to-opposite-quiet
	　&set-current-to-opposite が何も表示しなくなった(version 2.25
	における本命令と同じ動作になった)ので、削除されました。-quiet を
	削除して下さい。

&special-quick1
&special-quick2
&special-quick3
	　まどかの理念にそぐわない為、削除されました。それぞれ、

		--d- $<
		---k $P
		-md- $< $M

	などに置き換えて下さい。

&cursor-search
&toggle-current-move-mode
	既に意味のなくなっていた命令です。

&toggle-period-separate-mode
	　%sepa の削除に伴ない削除されました。現在は %winf 4 で相当する
	形式での表示となりますので、以下のように置き換えて下さい。

		&cal winf ($winf==0)?4:0


・名称が変更された内部命令

&infomation -> &information
	　綴りが間違えていたのを修正しました。'm' の直前に 'r' を入れて
	下さい。

&command-history-menu -> &command-history
	　実際にはメニューを表示しない(一行入力で選択・編集する)動作だっ
	たため、mint version 3.10 以降では名称が変更されました。

	※ mint version 3.00 の新命令 &command-history(メニューを表示す
	る)も、あわせて &command-history-menu に変更されました。


・仕様が変更された内部命令

&describe-key
&ext-help
	　'e' 及び 'v' キーで >HELP_E を実行した時、従来はキーワードがユ
	ーザ変数 MINTHWORD に設定されていましたが、定義ファイル内での行
	番号が MINTHLINE に設定されるように変更されました。

	例:
		>HELP_E	-api	em -g$MINTHLINE $MINTRC; &source
						# MicroEMACS の場合

		>HELP_E	-api	ed -n$MINTHLINE $MINTRC; &source
						# EDR-plus の場合

&go-screen-saver
	　-z オプションが追加されました。この命令は、通常は >T_DOWN の定
	義を実行しますが、-z オプションを指定すると内蔵スクリーンセーバ
	を実行します。なお、>T_DOWN 内でこの命令を使用した場合、-z オプ
	ションの有無に関わらず必ず内蔵スクリーンセーバを実行します。

	　代わりに、コマンドスイッチ -z が削除されました。

	例:
		>KEYrdn	-t--	&go-screen-saver	# >T_DOWN 実行
			-c--	&go-screen-saver -z	# 内蔵セーバ実行

		>T_DOWN	----	&crt-write-disable;
				&title-load -n in_the_night.mag;
				&go-screen-saver;	# 内蔵セーバ実行
				&pop-text;
				&end

&menu
	　選択肢を「1"one",2"two"」のように詰めて記述することが出来なく
	なったので、「1"one" 2"two"」のように ',' を空白に置き換えて下さ
	い。「1"one", 2"two"」など、',' の後に空白があるなら書き換えなく
	ても構いません。

&title-load
	　MIT 形式だけでなく、MAG 形式のファイルも指定できるようになりま
	した。環境変数 MINTTITLE に設定するファイルにも指定できます。た
	だし、256 色モードの MAG は表示できません。


・>LZHS_A

　>LZHS_A で lha.x を使っていた場合は、-r2 オプションを指定するようにし
て下さい。他の互換アーカイバを使っている場合はそのままで構いません。

例:	>LZHS_A -ap (BIN)lha u -axr2 $MINTARC


・@copy 

　コピー時に同名ファイルが存在した時に表示されるメニューを @copy セクシ
ョンで定義することが出来ましたが、スペースキーに対応する行の記述方法が変
更され、行頭に ' '(スペース)を置く代わりに '_' を置かなければならないよ
うになりました。

　@copy セクションを定義していた場合は、行頭の ' ' を '_' に書き換えて下
さい。

	例:
		@copy
		O	"上書きするにょ"
		_	"中身を比べるにょ"	# 1KB file compare
		N	"コピーしないにょ"
		...	...


・変更可能文字列

　&xxxxx "mmmmm" 形式で指定する変更可能文字列にも追加、削除、変更等あり
ますが、分量が多いのと、削除されたものを定義ファイルに残しておいても問題
ないので省略します。標準の定義を man/message.5 に置いておきますので参考
にして下さい(mint -m で表示されるものです)。

　現在使われていない文字列がありますが、将来削除あるいは変更される可能性
が十分にあります。


・実行ファイル名の自動書き換え

　一部の内部命令を実行中に、実行ファイル名を書き換えるようになりました。
例えば、mint.x を起動して &look-file を実行すると、&look-file 実行中は実
行ファイル名が mintlook.x であったかのようになります。LZD などの制御にフ
ァイル名を使用している場合は注意が必要です。

　実行ファイル名が書き換わる内部命令は以下の通りです。

	内部命令	実行ファイル名
	--------	--------------
	&data-title	mintdata.x
	&look-file	mintlook.x

　なお、この機能は実行ファイル名が mint.{x,r,z} でない場合は無効になりま
す(大文字小文字は区別しません)。

　LZD を使用している場合は、環境変数を

	setenv LZD_PROC_MODE '#f;mint.x'

と設定しておけば、ほとんどの場合で期待通りに動作すると思います。


・madoka 再構築

　mint のインタプリタ言語である madoka をソースコードレベルで完全に書き
換えました。

　エラーチェックが厳しくなったり、従来は実装上の理由で制限されていた機能
が許可されたり、システム予約変数が増えたりしたので、従来期待通りに動作し
ていた madoka スクリプトが予期しない動作をする、あるいは全く動作しなくな
る可能性があります。詳しくは v3_extend.man 及び v3_madoka.man を参照して
下さい。

　新しい madoka のコードは動作試験が十分でないため、バグが含まれている恐
れがあります。十分注意して下さい。


[EOF]
